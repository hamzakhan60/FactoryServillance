name: FYP-UI-Project CI/CD Pipeline

# Trigger on push and pull requests to main branch
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [18.x]

    steps:
      # 1️⃣ Checkout the repository code
      - name: Checkout code
        uses: actions/checkout@v3

      # 2️⃣ Setup Node.js environment
      - name: Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'

      # 3️⃣ Install project dependencies
      - name: Install dependencies
        run: npm install

      # 4️⃣ Build the React UI application
      - name: Build UI project
        run: npm run build

      # 5️⃣ Start the application in background for testing
      - name: Start application
        run: npm start &
        env:
          CI: true

      # 6️⃣ Wait for application to start
      - name: Wait for application to start
        run: npx wait-on https://factory-servillance.vercel.app/ --timeout 60000

      # 7️⃣ Run all UI Regression Tests (Dashboard + LiveMonitoring)
      - name: Run All UI Regression Tests
        run: npx @testim/testim-cli run --project "cuilahore" --tag "Regression" --token ${{ secrets.SCD }}
        continue-on-error: false

  deploy:
    needs: build-and-test
    runs-on: ubuntu-latest
    if: success()

    steps:
      # Checkout the repository code
      - name: Checkout code
        uses: actions/checkout@v3

      # Setup Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18.x
          cache: 'npm'

      # Install dependencies
      - name: Install dependencies
        run: npm install

      # Build production bundle
      - name: Build production bundle
        run: npm run build

      # Deployment placeholder
      - name: Deploy to production
        run: |
          echo "Deploying FYP-UI-Project to production..."
          # Add deployment commands here if needed
          # Example: AWS S3, Vercel, GitHub Pages
